import requests
from urllib.parse import urlparse, parse_qs
import pyfiglet

ascii_banner = pyfiglet.figlet_format("PARAMETER POLLUTION")
print(ascii_banner)

# Function to extract parameters from the target URL
def extract_parameters_from_url(url):
    try:
        # Send a GET request to the target URL
        response = requests.get(url)

        # Check if the request was successful
        if response.status_code == 200:
            # Parse the URL to extract parameters
            parsed_url = urlparse(url)
            query_parameters = parse_qs(parsed_url.query)
            return query_parameters
        else:
            print("Failed to fetch parameters from the target URL.")
            return None
    except Exception as e:
        print("An error occurred while fetching parameters:", e)
        return None

# Function to test for parameter pollution vulnerability
def test_parameter_pollution_vulnerability(url, parameters):
    if parameters is None:
        print("No parameters extracted. Exiting.")
        return

    try:
        # Make a copy of the original parameters dictionary
        original_params = parameters.copy()

        # Iterate over each parameter and add a dummy value
        for param, value in original_params.items():
            # Add a dummy value to the parameter
            parameters[param] = "dummy_value"

            # Send the request with modified parameters
            response = requests.get(url, params=parameters)

            # Check if the response indicates a potential parameter pollution
            if response.status_code != 200:
                print(f"Potential vulnerability detected for parameter '{param}' (medium vulnerability)")

            # Restore the original value of the parameter
            parameters[param] = value
    except Exception as e:
        print("An error occurred while testing for parameter pollution vulnerability:", e)

try:
    # Prompt the user to input the target website URL
    target_url = input("Enter the target website URL:")

    if input("Press Enter to Test Parameter Pollution Vulnerability:"):
        # Extract parameters from the target website URL
        target_parameters = extract_parameters_from_url(target_url)

        # Test for parameter pollution vulnerability
        test_parameter_pollution_vulnerability(target_url, target_parameters)
except KeyboardInterrupt:
    print("Process interrupted.")
